# 录制设置模块

这个模块实现了完整的录制设置功能,包括录制配置、日程管理、存储管理和文件预览。

## 文件结构

```
src/components/record/
├── RecordPage.js          # 主页面,包含标签页导航
├── RecordConfig.js        # 录制配置模块
├── RecordSchedule.js      # 日程管理模块
├── RecordStorage.js       # 存储管理模块
├── RecordPreview.js       # 文件预览模块
├── RecordPage.css         # 样式文件
└── README.md              # 说明文档
```

## 功能说明

### 1. 录制配置 (RecordConfig)

#### 全局规则配置
- 启用/禁用录制规则
- 选择录制格式 (MP4/JPG/RAW)
- 设置最小捕获间隔

#### 录制触发规则
支持四种触发方式:

**1. 定时触发 (Timer)**
- 设置触发间隔(秒)

**2. GPIO 触发**
- GPIO 引脚名称
- 初始电平 (高/低)
- 触发信号 (高电平/低电平/上升沿/下降沿)
- 去抖时长

**3. 串口触发 (TTY)**
- 串口名称
- 触发命令

**4. AI 推理触发 (最复杂)**
- 支持添加多个推理规则
- 每个规则可配置:
  - 规则名称
  - 确认帧数
  - 置信度范围 (最小/最大)
  - 类别筛选 (支持多选)
  - 触发区域 (支持绘制多个多边形区域)

#### AI 区域绘制功能
- 在画面上点击绘制多边形区域
- 支持添加多个区域
- 可视化显示已绘制的区域
- 支持删除区域

### 2. 日程管理 (RecordSchedule)

#### 可视化时间表
- 周一至周日的时间网格
- 横轴为24小时,时间粒度为30分钟
- 点击或拖动选择时间段
- 自动合并相邻时间段

#### 快捷操作
- 工作日 (周一至周五 9:00-18:00)
- 夜间 (18:00-06:00)
- 全天24小时
- 清空所有日程

#### 日程列表
- 显示所有已设置的日程
- 支持单独删除某个日程

### 3. 存储管理 (RecordStorage)

#### 存储设备管理
- 显示所有存储设备
- 设备状态监控:
  - 错误
  - 未格式化/格式不支持
  - 格式化中
  - 未挂载
  - 已挂载
  - 已配置
  - 索引中
  - 就绪

#### 存储空间监控
- 总空间/已用空间显示
- 配额使用情况
- 进度条可视化

#### 设备操作
- 启用/禁用设备
- 格式化
- 释放空间
- 配置配额
- 中继/取消中继
- 弹出设备 (可移动设备)

#### 设备配置
- 配额限制 (字节)
- 循环覆盖开关

#### 自动刷新
- 每5秒自动刷新存储状态

### 4. 文件预览 (RecordPreview)

#### 文件浏览
- 目录树导航
- 面包屑导航
- 网格/列表视图切换

#### 文件预览
- 图片预览 (JPG等)
- 视频播放 (MP4等)
- 模态框显示

#### 文件操作
- 下载文件
- 查看文件详情 (大小、修改时间)

#### 中继管理
- 启动文件访问中继
- 自动使用现有中继
- 显示中继状态

## API 调用

模块使用以下API端点:

### 录制配置
- `GET/POST /vigil/rule/config` - 全局规则配置
- `GET/POST /vigil/rule/record-rule-config` - 录制规则配置

### 日程管理
- `GET/POST /vigil/rule/schedule-rule-config` - 日程配置

### 存储管理
- `GET /vigil/storage/status` - 存储状态
- `GET/POST /vigil/storage/config` - 存储配置
- `POST /vigil/storage/control` - 存储控制

### 文件预览
- `GET /vigil/files/{relay_directory}/{file_path}` - 文件访问

## 样式特性

- 现代化的卡片式设计
- 渐变色按钮和进度条
- 流畅的过渡动画
- 响应式布局 (支持移动端)
- 自定义开关组件
- 模态框对话框

## 使用方法

1. 在 App.js 中,RecordSettings 页面已自动集成
2. 用户点击侧边栏的"录制设置"即可访问
3. 四个标签页可自由切换:
   - ⚙️ 录制配置
   - 📅 日程管理
   - 💾 存储管理
   - 🎬 文件预览

## 注意事项

1. **AI 区域绘制**: 至少需要3个点才能形成有效区域
2. **存储中继**: 访问文件前需要先启动中继,中继会在30秒不活动后超时
3. **文件列表**: 当前使用模拟数据,实际项目中需要后端提供文件列表API
4. **自动刷新**: 存储管理页面会每5秒自动刷新状态

## 技术栈

- React (Hooks)
- Axios (HTTP 请求)
- Canvas (区域绘制)
- CSS3 (动画和样式)

## 后续改进建议

1. 为文件预览添加缩略图
2. 支持批量下载文件
3. 添加文件搜索功能
4. AI 区域绘制增加编辑功能 (移动顶点、调整大小)
5. 日程管理增加模板保存功能
6. 存储管理增加RAID支持

